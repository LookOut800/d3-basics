"use strict";angular.module("soofaApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","d3"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/drink",{templateUrl:"views/drink.html",controller:"DrinkCtrl"}).when("/pie",{templateUrl:"views/pie.html",controller:"PieCtrl"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/"})}]),angular.module("soofaApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("soofaApp").controller("PieCtrl",["$scope",function(a){a.shared={data:[1]},a.charts=d3.range(10),a.chartClicked=function(){var b=Math.round(9*Math.random())+1;a.shared.data=d3.range(b).map(function(a){return Math.random()})}}]),angular.module("soofaApp").controller("DrinkCtrl",["$scope",function(a){a.charts=d3.range(10).map(function(){return d3.range(10).map(Math.random)}),a.shared={data:[1]},a.chartClicked=function(){var b=Math.round(9*Math.random())+1;a.shared.data=d3.range(b).map(function(a){return Math.random()})}}]),angular.module("soofaApp").directive("pieChart",["d3Service",function(a){function b(a,b){function c(a){var b=d3.interpolate(this._current,a);return this._current=b(0),function(a){return i(b(a))}}var d=d3.scale.category20(),e=500,f=500,g=Math.min(e,f),h=d3.layout.pie().sort(null),i=d3.svg.arc().outerRadius(g/2*.9).innerRadius(g/2*.5),j=d3.select("pie-chart").append("svg").attr({width:e,height:f}).attr("transform","translate(400, 10)").append("g").attr("transform","translate("+e/2+","+f/2+")");j.on("mousedown",function(b){a.$apply(function(){a.onClick&&a.onClick()})});var k=j.selectAll("path.arc").data(h(a.data)).enter().append("path").attr("class","arc").style("stroke","white").attr("fill",function(a,b){return d(b)}).each(function(a){return this._current=a});a.$watch("data",function(a,b){for(var e=a.slice(0),f=500,g=Math.PI;e.length<b.length;)e.push(0);k=j.selectAll(".arc").data(h(e)),k.transition().duration(f).attrTween("d",c),k.enter().append("path").style("stroke","white").attr("class","arc").attr("fill",function(a,b){return d(b)}).each(function(a){this._current={startAngle:2*g-.001,endAngle:2*g}}).transition().duration(f).attrTween("d",c),k.filter(function(a){return 0===a.data}).transition().duration(f).each(function(a){a.startAngle=2*g-.001,a.endAngle=2*g}).attrTween("d",c).remove()})}return{scope:{data:"=",onClick:"&"},restrict:"E",link:b}}]),angular.module("soofaApp").directive("drinkChart",["d3Service","$window","$timeout",function(a,b,c){return{restrict:"E",link:function(b,c,d,e){a.d3().then(function(a){var b={Year2006:0,Year2007:0,Year2008:0,Year2009:0,Year2010:0,Year2011:0,Year2012:0,Year2013:0,Year2014:0},c={top:20,right:20,bottom:30,left:80},d=700-c.left-c.right,e=500-c.top-c.bottom,f=(a.scale.category20(),a.scale.ordinal().rangeRoundBands([0,d],.1)),g=a.scale.linear().range([e,0]),h=a.svg.axis().scale(f).orient("bottom"),i=a.svg.axis().scale(g).orient("left"),j=a.select("drink-chart").append("svg").attr("width",d+c.left+c.right).attr("height",e+c.top+c.bottom).append("g").attr("transform","translate("+c.left+","+c.top+")");a.json("https://data.cityofboston.gov/resource/gb6y-34cq.json",function(c,k){k.forEach(function(a){var c="Year"+a.licenseadddttm.substring(0,4);b[c]+=1});var l=[];for(var m in b)l.push(b[m]);f.domain(Object.keys(b)),g.domain([0,a.max(l)]),j.append("g").attr("class","x axis").attr("transform","translate(0,460)").call(h),j.append("g").attr("class","y axis").call(i).attr("transform","translate(-15, 0)").append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".5em").style("text-anchor","end").text("Permits Issued"),j.selectAll(".bar").data(l).enter().append("rect").attr("class","bar").attr("width",f.rangeBand()).attr("y",function(a){return g(a)}).attr("height",function(a){return e-g(a)}).transition().duration(2e3).attr("transform",function(a,b){return"translate("+b*d/l.length+", 0)"}).attr("fill","steelblue")})})}}}]),angular.module("soofaApp").directive("drinkLineChart",["d3Service",function(a){return{restrict:"EA",scope:{},link:function(b,c,d){a.d3().then(function(a){a.json("https://data.cityofboston.gov/resource/gb6y-34cq.json",function(b){function c(){s.transition().style("opacity",.8).attr("fill","gray")}function d(b){s.text(a.event.pageY-k).style("left",a.event.pageX-24+"px").style("top",a.event.pageY-20+"px")}function e(){s.transition().style("opacity",1e-6)}var f={Year2006:0,Year2007:0,Year2008:0,Year2009:0,Year2010:0,Year2011:0,Year2012:0,Year2013:0,Year2014:0};b.forEach(function(a){var b="Year"+a.licenseadddttm.substring(0,4);f[b]+=1});var g=[];for(var h in f)g.push(f[h]);var i=a.range(8).map(function(a){return{x:a+1,y:g[a]}}),j=700,k=500,l={top:20,right:20,bottom:20,left:50},m=a.scale.linear().range([l.left,j-l.right]).domain([a.min(i,function(a){return a.x}),a.max(i,function(a){return a.x})]),n=a.scale.linear().range([k-l.top,l.bottom]).domain([a.min(i,function(a){return a.y}),a.max(i,function(a){return a.y})]),o=a.svg.axis().scale(m).tickValues([0,1,2,3,4,5,6,7,8]).tickSize(5).tickSubdivide(!0),p=a.svg.axis().scale(n).tickSize(5).orient("left").tickSubdivide(!0),q=a.select("drink-line-chart").append("svg").attr("width",j).attr("height",k);q.append("svg:g").attr("class","x axis").attr("transform","translate(0,"+(k-l.bottom)+")").call(o),q.append("svg:g").attr("class","y axis").attr("transform","translate("+l.left+",0)").call(p);var r=(a.time.format("%y-%m-%d").parse,a.svg.line().x(function(a){return m(a.x)}).y(function(a){return n(a.y)}).interpolate("monotone"));q.append("svg:path").attr("d",r(i)).attr("stroke","steelblue").attr("stroke-width",5).attr("fill","none").on("mouseover",c).on("mousemove",d).on("mouseout",e),q.append("text").attr("class","y label").attr("text-anchor","end").attr("y",10).attr("x",-50).attr("dy",".5em").attr("transform","rotate(-90)").text("Permits Issued");var s=a.select("drink-line-chart").append("div").attr("class","tooltip").style("opacity",1e-6)})})}}}]),angular.module("soofaApp").directive("orchardChart",["d3Service",function(a){function b(b,c,d){a.d3().then(function(a){var b=760,c=760,d=a.select("orchard-chart").append("svg").attr("width",b).attr("height",c).attr("class","well"),e=d.append("g"),f=d.append("g"),g=a.geo.mercator().center([42.409906001702296,-71.065948601971]).scale(75e3),h=(a.geo.path().projection(g).pointRadius(1),function(){a.json("https://data.cityofboston.gov/resource/cr3i-jj7v.json",function(a){for(var b=[],c=1;c<a.length;c++){var d={site:"Unnamed",longitude:"",latitude:"",location:""};d.longitude=parseFloat(a[c].map_location.longitude),d.latitude=parseFloat(a[c].map_location.latitude),d.site=a[c].site,d.location=a[c].location,b.push(d),f.selectAll("circle").data(b).enter().append("circle",".circle").attr("fill","white").transition().duration(2e3).attr("r",8).attr("fill","rgba(21, 103, 0, 0.7)").attr("class","circle").attr("id",function(a){return a.site}).attr("transform",function(a){return"translate("+g([a.latitude,a.longitude])+")"})}})}),i=function(){a.json("https://data.cityofboston.gov/resource/c7cz-29ak.json",function(a){var b=[];console.log(a);for(var c=1;c<a.length;c++){var d={site:"Unnamed",fruit:"Garden",longitude:"",latitude:"",coordinates:0};d.site=a[c].name,d.fruit=a[c].fruit,d.longitude=parseFloat(a[c].map_locations.longitude),d.latitude=parseFloat(a[c].map_locations.latitude),d.coordinates=parseInt(a[c].coordinates),b.push(d)}f.selectAll("orchard").data(b).enter().append("circle",".orchard").transition().duration(2e3).attr("r",8).attr("fill","rgba(239, 242, 71, 0.7)").attr("class","circle").attr("id",function(a){return a.site+" orchard"}).attr("transform",function(a){return"translate("+g([a.latitude,a.longitude])+")"})})};a.json("boston_neighborhoods.json",function(b,c){return b?console.error(b):(e.append("path").datum(topojson.feature(c,c.objects.counties)).attr("fill","white").transition().duration(3e3).attr("d",a.geo.path().projection(null)).attr("fill","gray"),void d.append("path").datum(topojson.mesh(c,c.objects.counties,function(a,b){return a!==b})).attr("class","boundary").attr("d",a.geo.path().projection(null)).attr("fill","none").attr("stroke","white"))}),i(),h()})}return{restrict:"EA",scope:{},link:b}}]),angular.module("d3",[]).factory("d3Service",["$document","$q","$rootScope",function(a,b,c){function d(){c.$apply(function(){e.resolve(window.d3)})}var e=b.defer(),f=a[0].createElement("script");f.type="text/javascript",f.async=!0,f.src="bower_components/d3/d3.js",f.onreadystatechange=function(){"complete"===this.readyState&&d()},f.onload=d;var g=a[0].getElementsByTagName("body")[0];return g.appendChild(f),{d3:function(){return e.promise}}}]);